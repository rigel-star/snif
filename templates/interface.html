<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <title>Sniffer</title>
        <style>
            body {
                font-family: Arial, sans-serif;
                padding: 20px;
                background: #1e1e1e;
                color: #ddd;
            }
            button {
                margin-right: 10px;
                padding: 8px 16px;
                font-size: 16px;
                cursor: pointer;
            }
            #packet-list {
                margin-top: 20px;
                max-height: 80vh;
                overflow-y: auto;
                border: 1px solid #555;
                border-radius: 6px;
                background: #2e2e2e;
                padding: 10px;
            }
            .packet {
                border-bottom: 1px solid #444;
                padding: 10px 0;
            }
            .field-group {
                margin-left: 20px;
                margin-top: 6px;
            }
            ield {
                margin-bottom: 4px;
            }
            .field-label {
                color: #aaf;
                font-weight: bold;
                display: inline-block;
                width: 200px;
            }
            .field-value {
                color: #ffa;
            }
        </style>
    </head>
    <body>

        <button id="startBtn">Start</button>
        <button id="stopBtn" disabled>Stop</button>

        <div id="packet-list"></div>

        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

        <script>
            const url = 'http://localhost:5000/if/{{interface}}/get';

            const startBtn = document.getElementById('startBtn');
            const stopBtn = document.getElementById('stopBtn');
            const packetList = document.getElementById('packet-list');
            let intervalId = null;

            function createField(label, value) {
                const div = document.createElement('div');
                div.className = 'field';
                div.innerHTML = `<span class="field-label">${label}:</span> <span class="field-value">${value}</span>`;
                return div;
            }

            function renderIPv4(data) {
                const container = document.createElement('div');
                container.className = 'field-group';

                container.appendChild(createField('Version', data.Version));
                container.appendChild(createField('Internet Header Length', data["Internet Header Length"]));
                container.appendChild(createField('Differentiated Services Code Point', data["Differentiated Services Code Point"]));
                container.appendChild(createField('Explicit Congestion Notification', data["Explicit Congestion Notification"]));
                container.appendChild(createField('Total Length', data["Totla Length"]));
                container.appendChild(createField('Identification', data.Identification));
                container.appendChild(createField('Flags', data.Flags));
                container.appendChild(createField('Offset', data.Offset));
                container.appendChild(createField('Time to Live', data["Time to Live"]));
                container.appendChild(createField('Protocol', data.Protocol));
                container.appendChild(createField('Checksum', data.Checksum));
                container.appendChild(createField('Source', data.Source));
                container.appendChild(createField('Destination', data.Destination));

                return container;
            }

            function renderPacket(packet) {
                const packetDiv = document.createElement('div');
                packetDiv.className = 'packet';

                packetDiv.appendChild(createField('Ethernet Source', packet.Source));
                packetDiv.appendChild(createField('Ethernet Destination', packet.Destination));

                if (packet.Data) {
                    const ipGroup = document.createElement('div');
                    ipGroup.className = 'field-group';
                    const ipTitle = document.createElement('div');
                    ipTitle.style.color = '#faa';
                    ipTitle.style.fontWeight = 'bold';
                    ipTitle.textContent = 'IPv4 Header:';
                    ipGroup.appendChild(ipTitle);

                    ipGroup.appendChild(renderIPv4(packet.Data));
                    packetDiv.appendChild(ipGroup);
                }

                return packetDiv;
            }

            function fetchPackets() {
                axios.get(url)
                .then(res => {
                    const data = JSON.parse(res.data['packets'] + "}");
                    const el = renderPacket(data);
                    packetList.prepend(el);
                })
                .catch(err => {
                    const errorDiv = document.createElement('div');
                    errorDiv.style.color = 'red';
                    errorDiv.textContent = `Error fetching packets: ${err}`;
                    packetList.prepend(errorDiv);
                });
            }

            startBtn.onclick = () => {
                if (intervalId) return;
                fetchPackets();
                intervalId = setInterval(fetchPackets, 2000);
                startBtn.disabled = true;
                stopBtn.disabled = false;
            };

            stopBtn.onclick = () => {
                if (!intervalId) return;
                clearInterval(intervalId);
                intervalId = null;
                startBtn.disabled = false;
                stopBtn.disabled = true;
            };
        </script>
    </body>
</html>
